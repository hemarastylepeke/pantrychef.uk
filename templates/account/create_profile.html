{% extends 'core/base_login.html' %}
{% load i18n %}
{% load static %}

{% block content %}
<div class="min-h-screen bg-gray-50 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
  <div class="max-w-3xl w-full bg-white shadow-lg rounded-xl p-8">
    <div class="mb-8 text-center">
      <h2 class="text-3xl font-bold text-gray-900">Create Your Profile</h2>
      <p class="text-lg text-gray-600 mt-2">Fill in a few details so we can personalize your experience.</p>
    </div>

    {% if messages %}
      <div class="space-y-3 mb-6">
        {% for message in messages %}
          <div class="px-4 py-3 rounded-lg border {{ message.tags|default:'bg-blue-50 text-blue-700 border-blue-200' }}">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <form method="post" enctype="multipart/form-data" class="space-y-8">
      {% csrf_token %}

      {% if form.non_field_errors %}
        <div class="bg-red-50 border border-red-300 text-red-700 px-4 py-3 rounded-lg">
          {{ form.non_field_errors }}
        </div>
      {% endif %}

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Profile image section -->
        <div class="col-span-1 flex flex-col items-center">
          <div class="w-48 h-48 bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl overflow-hidden flex items-center justify-center border-2 border-dashed border-gray-300 shadow-inner">
            <img id="profile-preview" src="{% if form.initial.profile_image %}{{ form.initial.profile_image.url }}{% else %}{% static 'profile_images/default_profile_image.png' %}{% endif %}" alt="Profile preview" class="object-cover w-full h-full">
          </div>

          <label class="mt-6 w-full">
            <span class="block text-sm font-semibold text-gray-700 mb-2">Profile Image</span>
            <div class="mt-1">
              <div class="relative">
                {{ form.profile_image }}
              </div>
              {% if form.profile_image.errors %}
                <p class="text-sm text-red-600 mt-2 font-medium">{{ form.profile_image.errors|first }}</p>
              {% endif %}
            </div>
          </label>

          <p class="text-xs text-gray-500 mt-4 text-center">Recommended: square image, max 2MB</p>
        </div>

        <!-- Form fields section -->
        <div class="col-span-2">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            {% for field in form %}
              {% if field.name != 'profile_image' %}
                <div class="space-y-2">
                  <label class="block text-sm font-semibold text-gray-700">
                    {{ field.label }}
                    {% if field.field.required %}
                      <span class="text-red-500 ml-1">*</span>
                    {% endif %}
                  </label>
                  <div class="mt-1">
                    {{ field }}
                  </div>
                  {% if field.help_text %}
                    <p class="text-xs text-gray-500 mt-1">{{ field.help_text }}</p>
                  {% endif %}
                  {% if field.errors %}
                    <p class="text-sm text-red-600 mt-1 font-medium">{{ field.errors|first }}</p>
                  {% endif %}
                </div>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      </div>

      <div class="flex items-center justify-between pt-6 border-t border-gray-200">
        <a href="{% url 'profile_page' %}" class="inline-flex items-center px-6 py-3 border border-gray-300 rounded-lg text-base font-medium text-gray-700 bg-white hover:bg-gray-50 hover:border-gray-400 transition-colors duration-200 shadow-sm">
          Cancel
        </a>

        <button type="submit" class="inline-flex items-center px-8 py-3 rounded-lg bg-gradient-to-r from-indigo-600 to-purple-600 text-gray-600 font-semibold hover:from-indigo-700 hover:to-purple-700 transform hover:scale-105 transition-all duration-200 shadow-lg">
          Create Profile
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  (function() {
    const fileInput = document.querySelector('input[type="file"][name="profile_image"]');
    const preview = document.getElementById('profile-preview');

    if (!fileInput) return;
    fileInput.addEventListener('change', function (e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function (evt) {
        preview.src = evt.target.result;
      };
      reader.readAsDataURL(file);
    });
  })();
</script>

<style>
/* Custom styles for form fields */
input[type="text"],
input[type="number"],
input[type="email"],
input[type="tel"],
input[type="date"],
select,
textarea {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid #d1d5db;
  border-radius: 10px;
  background-color: #f9fafb;
  font-size: 14px;
  color: #1f2937;
  transition: all 0.3s ease;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

/* Focus states */
input[type="text"]:focus,
input[type="number"]:focus,
input[type="email"]:focus,
input[type="tel"]:focus,
input[type="date"]:focus,
select:focus,
textarea:focus {
  outline: none;
  border-color: #6366f1;
  background-color: #ffffff;
  box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
  transform: translateY(-1px);
}

/* File input styling */
input[type="file"] {
  width: 100%;
  padding: 12px;
  border: 2px dashed #d1d5db;
  border-radius: 10px;
  background-color: #f8fafc;
  color: #6b7280;
  cursor: pointer;
  transition: all 0.3s ease;
}

input[type="file"]:hover {
  border-color: #6366f1;
  background-color: #f0f4ff;
}

input[type="file"]:focus {
  outline: none;
  border-color: #6366f1;
  box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

/* Select dropdown styling */
select {
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
  background-position: right 12px center;
  background-repeat: no-repeat;
  background-size: 16px;
  padding-right: 40px;
  appearance: none;
}

/* Number input styling */
input[type="number"] {
  -moz-appearance: textfield;
}

input[type="number"]::-webkit-outer-spin-button,
input[type="number"]::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

/* Placeholder styling */
::placeholder {
  color: #9ca3af;
  opacity: 1;
}

:-ms-input-placeholder {
  color: #9ca3af;
}

::-ms-input-placeholder {
  color: #9ca3af;
}

/* Error state styling */
input:invalid,
select:invalid,
textarea:invalid {
  border-color: #ef4444;
  background-color: #fef2f2;
}

/* Success state styling */
input:valid:not(:focus):not(:placeholder-shown),
select:valid:not(:focus),
textarea:valid:not(:focus):not(:placeholder-shown) {
  border-color: #10b981;
  background-color: #f0fdf4;
}

/* Button hover effects */
button:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 25px -5px rgba(99, 102, 241, 0.4);
}
</style>
{% endblock content %}